{"version":3,"file":"mlpChart.js","sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap 2400e3d877ec2053b26d","webpack:///src/index.js","webpack:///external \"d3\"","webpack:///src/charts.js","webpack:///src/chart/realTimeLineChart.js","webpack:///src/util.js"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"d3\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"mlpChart\", [\"d3\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"mlpChart\"] = factory(require(\"d3\"));\n\telse\n\t\troot[\"mlpChart\"] = factory(root[\"d3\"]);\n})(this, function(__WEBPACK_EXTERNAL_MODULE_2__) {\nreturn \n\n\n/** WEBPACK FOOTER **\n ** webpack/universalModuleDefinition\n **/"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/lib/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap 2400e3d877ec2053b26d\n **/","/**\r\n * Created by zhangqing on 2016/6/23.\r\n */\r\n/** @type {object} 导出的图表 */\r\nvar exportChart = require('./charts');\r\n/** @type {object} 对图表的一些工具 */\r\nvar utils = require('./util');\r\n/**\r\n * @param  {string} params.wrapContainer chart外部div\r\n * @param  {string} params.id chart的id, 如果不指定, 则会默认生成一个id\r\n * @param  {Array} params.dataset chart数据\r\n */\r\nmodule.exports = function(params) {\r\n\tif (typeof d3 === \"undefined\") {\r\n\t\tconsole.error(\"缺少d3.js\");\r\n\t\treturn;\r\n\t}\r\n\t\r\n\tif (typeof _ === \"undefined\") {\r\n\t\tconsole.error(\"缺少工具类, underscore.js\");\r\n\t\treturn;\r\n\t}\r\n\tvar chart = _.extend({}, exportChart);\r\n\tvar\r\n\t\tdataset = [],\r\n\t\twrapContainer = null,\r\n\t\tsvgContainer = null,\r\n\t\tdefContainer = null,\r\n\t\tchartId = params.id ? params.id : _.now();\r\n\r\n\tfunction drawSvgContainer() {\r\n\t\tvar widthString = wrapContainer.style('width'),\r\n\t\t\theightString = wrapContainer.style('height'),\r\n\t\t\twidth = Number(widthString.split('px')[0]),\r\n\t\t\theight = Number(heightString.split('px')[0]);\r\n\t\tsvgContainer = wrapContainer.append('svg').attr({\r\n\t\t\tid: \"mlpChart-\" + chartId,\r\n\t\t\twidth: widthString,\r\n\t\t\theight: heightString,\r\n\t\t\tclass: 'mlpChart'\r\n\t\t});\r\n\t\tdefContainer = svgContainer.append('defs');\r\n\t}\r\n\tif (params && params.wrapContainer && d3.select(params.wrapContainer).node()) {\r\n\t\twrapContainer = d3.select(params.wrapContainer);\r\n\t\tdrawSvgContainer();\r\n\t} else {\r\n\t\tconsole.error(\"no container, 缺少必要参数\");\r\n\t\treturn;\r\n\t}\r\n\tchart.utils = utils;\r\n\tchart.config = {\r\n\t\tdataset: dataset,\r\n\t\twrapContainer: wrapContainer,\r\n\t\tsvgContainer: svgContainer,\r\n\t\tdefContainer: defContainer,\r\n\t\tchartId: chartId\r\n\t};\r\n\tchart.api = null;\r\n\treturn chart;\r\n};\r\nmodule.exports.VERSION = \"1.0.0\";\r\nmodule.exports.D3VERSION = d3.version;\n\n\n/** WEBPACK FOOTER **\n ** src/index.js\n **/","module.exports = __WEBPACK_EXTERNAL_MODULE_2__;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"d3\"\n ** module id = 2\n ** module chunks = 0\n **/","/**\r\n * 导出的图表\r\n */\r\nmodule.exports = {\r\n\trealTimeLineChart: require('./chart/realTimeLineChart'),\r\n};\n\n\n/** WEBPACK FOOTER **\n ** src/charts.js\n **/","/**\r\n * @param { mlpChart } this \r\n * @return { mlpChart } this\r\n */\r\nvar realTimeLineChart = function() {\r\n\tconst api = {};\r\n\t/** @type { mlpChart } 使用 _this 代替 this */\r\n\tconst _this = this;\r\n\tvar realTimeLineChartParams = Array.prototype.slice.call(arguments)[0] ? Array.prototype.slice.call(arguments)[0] : {};\r\n\tvar commonConfig = {\r\n\t\tdataReady: realTimeLineChartParams.dataset ? true : false,\r\n\t\t/** @type {Array} 图表距离上左下右的距离 */\r\n\t\tmargin: [10, 10, 10, 0],\r\n\t\t/** @type {Array} 坐标轴距离上左下右的距离 */\r\n\t\taxisMargin: [0, 20, 20, 0],\r\n\t\tmaxNode: 20,\r\n\t\t/** @type {Function} path颜色函数 */\r\n\t\tcolor : d3.scale.category10(),\r\n\t\tupdateAnimationTime: 2000\r\n\t};\r\n\tvar config = _this.utils.mergeConfig.call(_this, _this.config, commonConfig, realTimeLineChartParams);\r\n\r\n\tfunction processData() {\r\n\t\tvar ds = config.dataset;\r\n\t}\r\n\t/** @type {object} 内部chart变量 */\r\n\tvar chartApi = null;\r\n\tfunction draw() {\r\n\t\tvar svgContainer = config.svgContainer,\r\n\t\t\tdefContainer = config.defContainer,\r\n\t\t\tdataset = config.dataset,\r\n\t\t\tsvgContainerProperties = _this.utils.svgContainerProperties.call(_this),\r\n\t\t\tmargin = config.margin,\r\n\t\t\tchartWidth = svgContainerProperties.w - (margin[1] + margin[3]),\r\n\t\t\tchartHeight = svgContainerProperties.h - (margin[0] + margin[2]),\r\n\t\t\taxisMargin = config.axisMargin,\r\n\t\t\tcolor = config.color,\r\n\t\t\tmaxNode = config.maxNode;\r\n\t\tfunction axisDomain(){\r\n\t\t\t//draw chart axis, => x\r\n\t\t\tvar xFunc = d3.scale.linear()\r\n\t\t\t\t.domain([0, maxNode - 1])\r\n\t\t\t\t.range([0, chartWidth]);\r\n\r\n\t\t\tvar\tallData = [0];\r\n\t\t\t_.each(dataset,function(d){\r\n\t\t\t\tallData =allData.concat(d.data);\r\n\t\t\t});\r\n\t\t\tvar yFunc = d3.scale.linear()\r\n\t\t\t\t.domain([0,d3.max(allData)*1.1])\r\n\t\t\t\t.range([chartHeight - axisMargin[2], 0]);\r\n\t\t\treturn {\r\n\t\t\t\tx: xFunc,\r\n\t\t\t\ty: yFunc,\r\n\t\t\t\txaxis: d3.svg.axis().scale(xFunc).orient(\"bottom\").ticks(5),\r\n\t\t\t\tyaxis: d3.svg.axis().scale(yFunc).orient(\"right\").ticks(5)\r\n\t\t\t};\r\n\t\t}\r\n\t\tif (!config.dataReady) {\r\n\t\t\tprocessData();\r\n\t\t}\r\n\r\n\t\tvar chart = svgContainer\r\n\t\t\t.append('g')\r\n\t\t\t.attr('class','chartWrap')\r\n\t\t\t.attr(\"transform\", \"translate(\" + margin[0] + \",\" + margin[1] + \")\");\r\n\t\t//draw chart background\r\n\t\tchart.append('rect')\r\n\t\t\t.attr({\r\n\t\t\t\twidth: chartWidth,\r\n\t\t\t\theight: chartHeight,\r\n\t\t\t\tx: 0,\r\n\t\t\t\ty: 0,\r\n\t\t\t\tfill: 'transparent',\r\n\t\t\t\tclass: 'mlpChart-bg'\r\n\t\t\t});\r\n\t\t/** @type {object} x,y轴 domain */\r\n\t\tvar axis = axisDomain();\r\n\r\n\t\tchart.append('g')\r\n\t\t\t.attr({\r\n\t\t\t\t'class': 'x axis',\r\n\t\t\t\t'transform': \"translate(0,\" + axis.y(0) + \")\"\r\n\t\t\t})\r\n\t\t\t.call(axis.xaxis);\r\n\r\n\t\tchart.append('g')\r\n\t\t\t.attr({\r\n\t\t\t\t'class': 'y axis',\r\n\t\t\t\t'transform': \"translate(\" + axis.x(0) + \",0)\"\r\n\t\t\t})\r\n\t\t\t.call(axis.yaxis);\r\n\t\t\t//draw clip\r\n\t\tvar clipUniqueId = 'clip_' + _.uniqueId();\r\n\t\tdefContainer.append('clipPath')\r\n\t\t\t.attr({\r\n\t\t\t\t\"id\": clipUniqueId\r\n\t\t\t})\r\n\t\t\t.append('rect')\r\n\t\t\t.attr({\r\n\t\t\t\theight: chartHeight,\r\n\t\t\t\twidth: chartWidth,\r\n\t\t\t\tx:1\r\n\t\t\t});\r\n\r\n\t\tvar line = d3.svg.line()\r\n\t\t\t.x(function(d, i) {\r\n\t\t\t\treturn axis.x(i);\r\n\t\t\t})\r\n\t\t\t.y(function(d, i) {\r\n\t\t\t\treturn axis.y(d);\r\n\t\t\t});\r\n\t\tvar chartContent = chart.append('g')\r\n\t\t\t.attr({\r\n\t\t\t\t'class':'chartContent',\r\n\t\t\t\t\"clip-path\": \"url(#\"+clipUniqueId+\")\"\r\n\t\t\t});\r\n\t\t\r\n\t\tchartContent\r\n\t\t\t.selectAll('g.entity')\r\n\t\t\t.data(dataset)\r\n\t\t\t.enter()\r\n\t\t\t.append('g')\r\n\t\t\t.attr({\r\n\t\t\t\tclass: 'entity'\r\n\t\t\t})\r\n\t\t\t.append('path')\r\n\t\t\t.attr({\r\n\t\t\t\td: function(d,i){\r\n\t\t\t\t\treturn line(d.data);\r\n\t\t\t\t},\r\n\t\t\t\t'stroke':function(d,i){\r\n\t\t\t\t\treturn color(i);\r\n\t\t\t\t},\r\n\t\t\t\t'fill':'none',\r\n\t\t\t\t'stroke-width':'2px',\r\n\t\t\t\t'opacity':0.8\r\n\t\t\t})\r\n\t\t\t.on('mouseover',function(){\r\n\t\t\t\td3.select(this).attr({\r\n\t\t\t\t\t\"stroke-width\":'4px',\r\n\t\t\t\t\t'opacity':1\r\n\t\t\t\t});\r\n\t\t\t})\r\n\t\t\t.on('mouseout',function(){\r\n\t\t\t\td3.select(this).attr({\r\n\t\t\t\t\t\"stroke-width\":'2px',\r\n\t\t\t\t\t'opacity':0.8\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\tchartContent\r\n\t\t\t.selectAll('g.entity').each(function(d,i){\r\n\t\t\t\td3.select(this)\r\n\t\t\t\t\t.selectAll('circle')\r\n\t\t\t\t\t.data(d.data)\r\n\t\t\t\t\t.enter()\r\n\t\t\t\t\t.append('circle')\r\n\t\t\t\t\t.attr({\r\n\t\t\t\t\t\tr: 3,\r\n\t\t\t\t\t\tcx: function(cd,ci){\r\n\t\t\t\t\t\t\treturn axis.x(ci);\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tcy: function(cd,ci){\r\n\t\t\t\t\t\t\treturn axis.y(cd);\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tfill: color(i)\r\n\t\t\t\t\t});\r\n\t\t\t\t\t\r\n\t\t\t});\r\n\r\n\t\tfunction update(){\r\n\t\t\tvar newDs = config.dataset;\r\n\t\t\taxis = axisDomain();\r\n\t\t\tchartContent\r\n\t\t\t\t.selectAll('g.entity')\r\n\t\t\t\t.data(newDs)\r\n\t\t\t\t.select('path')\r\n\t\t\t\t.attr({\r\n\t\t\t\t\td: function(d,i){\r\n\t\t\t\t\t\treturn line(d.data);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\tchartContent\r\n\t\t\t\t.selectAll('g.entity').each(function(d,i){\r\n\t\t\t\t\td3.select(this)\r\n\t\t\t\t\t\t.selectAll('circle')\r\n\t\t\t\t\t\t.data(d.data)\r\n\t\t\t\t\t\t.attr({\r\n\t\t\t\t\t\t\tcx: function(cd,ci){\r\n\t\t\t\t\t\t\t\treturn axis.x(ci);\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tcy: function(cd,ci){\r\n\t\t\t\t\t\t\t\treturn axis.y(cd);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\tanimation();\t\r\n\t\t}\r\n\t\tfunction animation(){\r\n\t\t\tchart.select('.y.axis')\r\n\t\t\t\t.transition()\r\n\t\t\t\t.duration(500)\r\n\t\t\t\t.call(axis.yaxis);\r\n\r\n\t\t\tchart.select('.x.axis')\r\n\t\t\t\t.transition()\r\n\t\t\t\t.duration(500)\r\n\t\t\t\t.call(axis.xaxis);\r\n\r\n\t\t\tchartContent\r\n\t\t\t\t.selectAll('g.entity')\r\n\t\t\t\t.attr('transform',\"translate(0,0)\")\r\n\t\t\t\t.transition()\r\n\t\t\t\t.duration(config.updateAnimationTime - 30)\r\n\t\t\t\t.ease(\"linear\")\r\n\t\t        .attr(\"transform\", \"translate(\" + axis.x(-1) + \",0)\")\r\n\t\t        .each('end',function(d,i){\r\n\t\t        \tif(d.data.length > maxNode){\r\n\t\t        \t\td.data.shift();\r\n\t\t        \t}\r\n\t\t        });\r\n\t\t}\r\n\t\tchartApi = {\r\n\t\t\tupdate: update\r\n\t\t};\r\n\t\treturn _this;\r\n\t}\r\n\tfunction update(increaseData){\r\n\t\t// increaseData = [(Math.random()*100).toFixed(4),(Math.random()*100).toFixed(4)]\r\n\t\tif(!chartApi) {return}\r\n\t\tvar dataset = config.dataset;\r\n\t\tif(increaseData.length != dataset.length ) {return;}\r\n\t\t_.each(increaseData, function(d,i){\r\n\t\t\tdataset[i].data.push(d);\r\n\t\t});\r\n\t\tchartApi.update();\r\n\t}\r\n\r\n\tfunction getConfig() {\r\n\t\treturn config;\r\n\t}\r\n\r\n\tfunction setConfig(newConfig) {\r\n\t\tnewConfig = newConfig ? newConfig : {};\r\n\t\tconfig = _.extend({}, config, newConfig);\r\n\t}\r\n\t_this.api = {\r\n\t\tgetConfig: getConfig,\r\n\t\tsetConfig: setConfig,\r\n\t\tdraw: draw,\r\n\t\tupdate: update\r\n\t};\r\n\treturn _this;\r\n};\r\nmodule.exports = realTimeLineChart;\n\n\n/** WEBPACK FOOTER **\n ** src/chart/realTimeLineChart.js\n **/","module.exports = {\r\n\tmergeConfig : function(){\r\n\t\tvar allConfig = Array.prototype.slice.call(arguments);\r\n\t\tvar config = {};\r\n\t\t_.each(allConfig,function(c){\r\n\t\t\tconfig = _.extend(config,c);\r\n\t\t});\r\n\t\treturn config;\r\n\t},\r\n\tsvgContainerProperties: function(){\r\n\t\tif(!this.config) {return}\r\n\t\tvar svgContainer = this.config.svgContainer;\r\n\t\tvar widthString = svgContainer.style('width'),\r\n\t\t\theightString = svgContainer.style('height'),\r\n\t\t\twidth = Number(widthString.split('px')[0]),\r\n\t\t\theight = Number(heightString.split('px')[0]);\r\n\t\treturn {\r\n\t\t\tw: width,\r\n\t\t\th: height,\r\n\t\t\twidthString: widthString,\r\n\t\t\theightString: heightString\r\n\t\t};\r\n\t}\r\n};\n\n\n/** WEBPACK FOOTER **\n ** src/util.js\n **/"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACVA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;AClCA;;AAEA;;;;;;AAMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAMA;AACA;AAAA;AAAA;AAAA;AAIA;AACA;AACA;AACA;AACA;AAJA;AAMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AALA;AAOA;AACA;AACA;AACA;;;;;;;;AC7DA;;;;;;;;;;;ACGA;AACA;AADA;;;;;;;;;;;;ACCA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AATA;AAWA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAUA;;AAEA;AACA;AAGA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AAJA;AAMA;AACA;AACA;AACA;AACA;AACA;;AAKA;AAEA;AACA;AACA;AACA;AACA;AACA;AANA;;AASA;AACA;AACA;AAEA;AACA;AAFA;AACA;AAKA;AAEA;AACA;AAFA;;AAMA;AACA;AAEA;AADA;AAKA;AACA;AACA;AAHA;AACA;AAKA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAFA;AACA;AAIA;AAMA;AADA;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AATA;AAYA;AACA;AACA;AAFA;AAIA;AAEA;AACA;AACA;AAFA;AAIA;AACA;AACA;AAEA;AAMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AARA;AAWA;AACA;AACA;AACA;AACA;AACA;AAKA;AACA;AACA;AAHA;AACA;AAKA;AAEA;AAIA;AACA;AACA;AACA;AACA;AACA;AANA;AAQA;AACA;AACA;AACA;AACA;AACA;AAIA;AACA;AAIA;AAQA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AAGA;AACA;AACA;;AAEA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAJA;AAMA;AACA;;;;;;;;;;AC/PA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AAIA;AACA;AACA;AACA;AACA;AAJA;AAMA;AAtBA;;;;;","sourceRoot":""}